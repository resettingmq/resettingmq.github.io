<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> flask分析_import_name · Keep mind occupied</title><meta name="description" content="flask分析_import_name - resettingmq"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://resettingmq.github.io/atom.xml" title="Keep mind occupied"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">flask分析_import_name</h1><div class="post-info">2017年4月27日</div><div class="post-content"><h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>According to <a href="http://flask.pocoo.org/docs/0.12/quickstart/#quickstart" target="_blank" rel="external">Flask Quickstart</a>:</p>
<blockquote>
<p><cite> This is needed so that Flask knows where to look for templates, static files, and so on. </cite></p>
</blockquote>
<p>And <a href="http://flask.pocoo.org/docs/0.12/api/#flask.Flask" target="_blank" rel="external">Flask API definition</a>:</p>
<blockquote>
<p><cite> The idea of the first parameter is to give Flask an idea of what belongs to your application. This name is used to find resources on the files system, can be used by extensions to improve debugging information and a lot more. </cite></p>
</blockquote>
<p>Flask实例根据<code>import_name</code>确定<code>templates</code>，<code>static files</code>等组件在文件系统中的查找路径。</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># flask/app.py</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flask</span><span class="params">(_PackageBoundObject)</span>:</span></div><div class="line">    <span class="comment"># ... </span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, static_folder=<span class="string">'static'</span>, template_folder=<span class="string">'templates'</span>, root_path=None, ...)</span>:</span></div><div class="line">        _PackageBoundObject.__init__(self, import_name,</div><div class="line">                                    template_folder=template_folder,</div><div class="line">                                    static_folder=static_folder,</div><div class="line">                                    root_path=root_path)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># flask/helpers.py</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">_PackageBoundObject</span><span class="params">()</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, import_name, template_folder=None, static_folder=None, root_path=None)</span>:</span></div><div class="line">        self.import_name = import_name</div><div class="line">        self.template_folder = template_folder</div><div class="line"></div><div class="line">        <span class="keyword">if</span> root_path <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            root_path = get_root_path(self.import_name)</div><div class="line">        self.root_path = root_path</div><div class="line">        <span class="comment"># ... more codes ...</span></div><div class="line">    <span class="comment"># ... more codes ...</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_root_path</span><span class="params">(import_name)</span>:</span></div><div class="line">    mod = sys.modules.get(import_name)</div><div class="line">    <span class="keyword">if</span> mod <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">and</span> hasattr(mod, <span class="string">'__file__'</span>):</div><div class="line">        <span class="keyword">return</span> os.path.basename(os.path.abspath(mod.__file__))</div><div class="line">    </div><div class="line">    loader = pkgutil.get_loader(import_name)</div><div class="line">    <span class="keyword">if</span> loader <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> import_name == <span class="string">'__main__'</span>:</div><div class="line">        <span class="keyword">return</span> os.getcwd()</div></pre></td></tr></table></figure>
<p><code>Flask</code>类继承自<code>_PackageBoundObject</code>.<br>可以看到，<code>Flask</code>对象中存在一个<code>root_path</code>属性：</p>
<ul>
<li>如果在初始化<code>Flask</code>对象时没有设置该属性，该属性的值由<code>import_name</code>的值计算得到；</li>
<li>如果在初始化<code>Flask</code>对象时设置了<code>root_path</code>的值，则使用该指定值。</li>
</ul>
<p>参考<a href="http://flask.pocoo.org/docs/0.12/api/#application-object" target="_blank" rel="external">Flask API definition</a>:</p>
<blockquote>
<p><cite> <strong>root_path</strong> - Flask by default will automatically calculate the path to the root of the application. In certain situations this cannot be achieved (for instance if the package is a Python 3 namespace package) and needs to be manually defined. </cite></p>
</blockquote>
<p>那么，<code>Flask.root_path</code>属性有什么作用呢？</p>
<p>例如，在<code>Flask.jinja_loader()</code>中，根据<code>Flask.root_path</code>和<code>Flask.template_folder</code>返回<code>loader</code>。</p>
<p>又如，在<code>Flask.open_resource()</code>方法中，<code>resource</code>也是相对<code>Flask.root_path</code>的路径得到的。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/04/23/lxml-html学习笔记/" class="prev">上一篇</a><a href="/2017/04/27/flask分析-routing/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2017 <a href="https://resettingmq.github.io">resettingmq</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>