<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> flask_web_开发_测试驱动开发 · Keep mind occupied</title><meta name="description" content="flask_web_开发_测试驱动开发 - resettingmq"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://resettingmq.github.io/atom.xml" title="Keep mind occupied"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">flask_web_开发_测试驱动开发</h1><div class="post-info">2017年5月21日</div><div class="post-content"><p>开始看Miguel Grinberg所著的Flask Web开发，试着利用测试驱动的方式把书中的例子自己实现一遍，在这里记录一下在这个过程中自己的一些心得体会。</p>
<h2 id="功能模块-vs-逻辑模块"><a href="#功能模块-vs-逻辑模块" class="headerlink" title="功能模块 vs. 逻辑模块"></a>功能模块 vs. 逻辑模块</h2><p>首先遇到的选择是<code>TestCase</code>的划分。例如在用户认证的模块中，需要建立请求url<code>url rule</code>到视图函数<code>view_func</code>映射关系的测试。</p>
<p>如果把对于所有逻辑模块（例如用户认证模块等）的映射测试放到一个单独的<code>TestCase</code>中，这样就可以方便的在这个<code>TestCase</code>中加入对映射关系测试需要用到的辅助函数，便于代码重用和调试。</p>
<p>如果把所有的某个逻辑模块的url映射测试放到各模块对应的<code>TestCase</code>中，方便于逻辑模块的增删，不需要修改多个测试文件。在这种方式下，可以将url关系测试的辅助函数放入<code>TestCaseMixin</code>中，这样也能达到代码重用的目的，而不需要在各逻辑模块的测试用分别定义这些辅助函数。</p>
<h2 id="TestCase-Mixin"><a href="#TestCase-Mixin" class="headerlink" title="TestCase Mixin"></a>TestCase Mixin</h2><p>在各逻辑模块的<code>TestCase</code>中，包含着需要相同的测试逻辑。例如，对表单响应中应该包含<code>csrf_token</code>的测试。对于这些测试，也可以提取到<code>Mixin</code>中。</p>
<h2 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h2><ol>
<li>在测试用例中如果需要用到<code>url_for()</code>，则需要保证由活动的<code>app_context</code>，同时还需要设置<code>app.config</code>的<code>SERVER_NAME</code>的配置值。</li>
</ol>
<p>这是因为<code>url_for()</code>需要用到<code>MapAdapter</code>对象来匹配<code>url rule</code>与<code>endpoint</code>之间的映射关系。这个对象是在<code>ApplicationContext</code>或者<code>RequestContext</code>初始化的时候被建立的，所以至少需要保证有活动的<code>app_context</code>。</p>
<p>同时，<code>MapAdapter</code>对象建立至少需要<code>SERVER_NAME</code>参数（或者<code>environ</code>对象），所以在测试初始化的时候，需要配置<code>app.config</code>，使之正确设置<code>SERVER_NAME</code>的值。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/04/30/Werkzeug-Thread-Local学习/" class="prev">PREV</a><a href="/2017/07/05/datatables-with-django/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="https://resettingmq.github.io">resettingmq</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>